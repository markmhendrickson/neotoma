{
  "$schema": "https://www.cursor.com/schemas/commands.json",
  "commands": [
    {
      "name": "Dev: Serve Full Stack",
      "description": "Run npm run dev:serve to start HTTP + UI servers with diagnostics",
      "shell": {
        "command": "bash -lc 'set -e; PORT_LINES=$(node scripts/get-branch-ports.js | grep -E \"^(HTTP|VITE|WS)_PORT\" || true); if [ -n \"$PORT_LINES\" ]; then echo \"[dev-serve] Using branch ports:\"; echo \"$PORT_LINES\"; fi; npm run dev:serve'",
        "cwd": ".",
        "env": {
          "NODE_ENV": "development"
        }
      }
    },
    {
      "name": "debug",
      "description": "Run dev-serve in the background, then show the debugging workflow",
      "shell": {
        "command": "bash -lc 'set -euo pipefail; LOG_FILE=\"/tmp/neotoma-dev-serve.log\"; if pgrep -f scripts/dev-serve.js >/dev/null 2>&1; then echo \"[debug] Stopping existing dev-serve instance...\"; pkill -f scripts/dev-serve.js >/dev/null 2>&1 || true; sleep 1; fi; echo \"[debug] Starting dev-serve in background (logs: $LOG_FILE)...\"; nohup npm run dev:serve >\"$LOG_FILE\" 2>&1 & PID=$!; sleep 2; echo \"[debug] dev-serve running with PID $PID. Monitor logs via: tail -f $LOG_FILE\"; cat .cursor/commands/debug.md'"
      }
    },
    {
      "name": "pull-dev",
      "description": "Merge the local dev branch into the currently checked-out branch",
      "shell": {
        "command": "bash -lc 'set -euo pipefail; CURRENT=$(git rev-parse --abbrev-ref HEAD); if [ \"$CURRENT\" = \"dev\" ]; then echo \"[pull-dev] Already on dev branch; nothing to merge.\"; exit 0; fi; echo \"[pull-dev] Merging local dev into $CURRENT\"; git merge --no-ff dev'",
        "cwd": "."
      }
    }
  ]
}

