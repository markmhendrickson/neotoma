---
description: "Automatically run database migrations after creating or modifying migration files"
globs: ["**/*"]
alwaysApply: true
---

# Database Migration Automation Rule

## Purpose

Automatically apply database migrations after creating or modifying migration files to ensure changes are immediately applied to the database.

## Rule

**MANDATORY:** When creating, modifying, or updating any migration file in `supabase/migrations/`, the agent MUST automatically run:

```bash
npm run migrate
```

## When to Apply

1. **After creating a new migration file** - Apply immediately after writing the migration
2. **After modifying an existing migration** - Re-apply if migration file is edited
3. **After fixing migration issues** - Re-run after fixing syntax errors or policy conflicts

## Implementation

- Run `npm run migrate` automatically without asking the user
- Do not wait for explicit user request
- Report success/failure of migration application
- If migration fails, attempt to fix issues (e.g., add `DROP POLICY IF EXISTS` for policy conflicts) and re-run

## Rationale

- Ensures migrations are applied immediately after creation
- Prevents forgetting to apply migrations
- Catches migration errors early
- Maintains database schema consistency
