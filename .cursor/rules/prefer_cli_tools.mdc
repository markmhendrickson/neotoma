# Prefer CLI Tools Rule

**Reference:** `foundation/agent_instructions/cursor_rules/configuration_management.md` - Configuration management

## Purpose

Ensures agents always prefer CLI tools over dashboard/UI access when checking logs, configuring services, querying data, or performing administrative tasks. CLI tools are more automatable, scriptable, and provide better integration with development workflows.

## Trigger Patterns

When any of the following occur, agents MUST use CLI tools instead of dashboard/UI:

- **Checking logs** (Supabase, SendGrid, application logs)
- **Querying databases** (Supabase, PostgreSQL)
- **Configuring services** (Supabase settings, SMTP, environment variables)
- **Managing resources** (users, projects, deployments)
- **Checking status** (service health, configuration state)
- **Installing dependencies** (package managers, tools)

## Agent Actions

### Step 1: Check for Available CLI Tools

Before suggesting dashboard access, check if CLI tools are available:

1. **Check if tool is installed:**
   ```bash
   which supabase
   which op
   which gh
   which aws
   ```

2. **Check if tool can be installed:**
   - Package managers: `brew`, `npm`, `pip`
   - Official installers
   - Documentation for installation

3. **Verify CLI has required functionality:**
   - Check CLI documentation
   - Test basic commands
   - Verify authentication/configuration

### Step 2: Use CLI Tools

**For Supabase:**
- Use `supabase` CLI for logs, configuration, database queries
- Install if not available: `brew install supabase/tap/supabase`
- Authenticate: `supabase login`

**For 1Password:**
- Use `op` CLI for credential access
- Already required for environment variable management

**For Git/GitHub:**
- Use `git` CLI for all git operations
- Use `gh` CLI for GitHub API operations

**For Cloud Services:**
- Use `aws` CLI for AWS services
- Use `gcloud` CLI for Google Cloud
- Use service-specific CLIs when available

### Step 3: Provide Installation Instructions

If CLI is not installed, provide installation steps:

1. **Check installation method:**
   - Homebrew (macOS): `brew install {tool}`
   - npm: `npm install -g {tool}`
   - Official installer
   - Package manager

2. **Provide authentication steps:**
   - Login commands
   - Configuration steps
   - Credential setup

3. **Verify installation:**
   - Test command
   - Check version
   - Verify functionality

## Examples

### ✅ Correct: Use Supabase CLI for Logs

```bash
# Check if Supabase CLI is installed
if ! command -v supabase &> /dev/null; then
  echo "Installing Supabase CLI..."
  brew install supabase/tap/supabase
fi

# View auth logs
supabase projects logs --project-ref {PROJECT_ID} --type auth

# Query database
supabase db query "SELECT * FROM auth.users ORDER BY created_at DESC LIMIT 5"
```

### ✅ Correct: Use 1Password CLI

```bash
# Fetch credentials via CLI
op item get "Sendgrid" --vault Private --fields "API key"
```

### ✅ Correct: Use GitHub CLI

```bash
# Check PR status
gh pr list --state open

# View logs
gh run list --workflow=ci.yml
```

### ❌ Incorrect: Suggest Dashboard Access First

```bash
# WRONG - Don't suggest dashboard without checking CLI first
echo "Go to Supabase Dashboard → Authentication → Logs"
```

### ❌ Incorrect: Skip CLI Installation

```bash
# WRONG - Don't skip CLI if it can be installed
if ! command -v supabase &> /dev/null; then
  echo "CLI not available, use dashboard"  # Should install CLI instead
fi
```

## CLI Tools Priority

**Always check for CLI tools in this order:**

1. **Official CLI** (supabase, op, gh, aws, gcloud)
2. **Package manager tools** (brew, npm, pip)
3. **Script-based tools** (curl + API, custom scripts)
4. **Dashboard/UI** (only as last resort)

## Installation Commands

**Common CLI tools:**

```bash
# Supabase CLI
brew install supabase/tap/supabase

# GitHub CLI
brew install gh

# AWS CLI
brew install awscli

# 1Password CLI (already required)
brew install 1password-cli

# Node.js tools
npm install -g {package}

# Python tools
pip install {package}
```

## Constraints

- **MUST check for CLI tools** before suggesting dashboard access
- **MUST provide installation steps** if CLI is not installed
- **MUST use CLI tools** when available and functional
- **MUST NOT default to dashboard** without checking CLI first
- **MUST verify CLI functionality** after installation

## When Dashboard is Acceptable

Dashboard/UI access is acceptable only when:

1. **CLI tool doesn't exist** for the functionality
2. **CLI tool is not available** and cannot be installed
3. **CLI tool lacks required functionality** (rare edge cases)
4. **User explicitly requests dashboard** access

Even in these cases, document that CLI would be preferred if available.

## Related Documents

- `foundation/agent_instructions/cursor_rules/environment_variables_1password.mdc` - 1Password CLI usage
- `foundation/agent_instructions/cursor_rules/configuration_management.md` - Configuration management

## Agent Instructions

### When to Load This Document

Load this document when:
- Checking logs or status
- Configuring services
- Querying databases
- Managing resources
- User requests dashboard access

### Required Co-Loaded Documents

- `foundation/agent_instructions/cursor_rules/configuration_management.md` - Configuration management
- `foundation/agent_instructions/cursor_rules/environment_variables_1password.mdc` - CLI credential access

### Constraints Agents Must Enforce

1. Always check for CLI tools before suggesting dashboard access
2. Provide installation steps if CLI is not installed
3. Use CLI tools when available and functional
4. Verify CLI functionality after installation
5. Document CLI preference even when dashboard is used

### Forbidden Patterns

- Suggesting dashboard access without checking for CLI first
- Skipping CLI installation when tool is available
- Defaulting to dashboard without verifying CLI availability
- Not providing CLI installation instructions

### Validation Checklist

- [ ] Checked for CLI tool availability (`which {tool}`)
- [ ] Provided installation steps if CLI not installed
- [ ] Used CLI tool for the task (if available)
- [ ] Verified CLI functionality after installation
- [ ] Documented CLI preference in scripts/docs
