---
description: "Automatically apply design system changes from docs/ui/design_system.md or StyleGuide.tsx to CSS variables and component implementations"
globs:
  [
    "docs/ui/design_system.md",
    "frontend/src/components/StyleGuide.tsx",
    "frontend/src/index.css",
    "frontend/src/shared/src/index.css",
  ]
alwaysApply: true
---

# ⚠️  DO NOT EDIT THIS FILE DIRECTLY
#
# This is a copy of: docs/ui/design_system_automation_rules.mdc
# Source of truth: docs/ui/design_system_automation_rules.mdc
#
# To edit this rule:
# 1. Edit the source file: docs/ui/design_system_automation_rules.mdc
# 2. Run '/setup_cursor_copies' to sync changes
#
# This file will be overwritten when running setup_cursor_copies.


# Design System Automation Rule

## Purpose

Automatically apply design system changes from browser preview CSS modifications or design system documentation (`docs/ui/design_system.md`) to CSS variables and component implementations throughout the app when the design system is modified.

## Rule

**MANDATORY:** When CSS style changes are made in browser preview OR when creating, modifying, or updating `docs/ui/design_system.md` OR when modifying `frontend/src/components/StyleGuide.tsx`, the agent MUST automatically:

1. **Extract design tokens** from browser preview changes or design system document
2. **Update CSS variables** in `frontend/src/index.css` to match design system values
3. **Update component implementations** if design system changes affect component styles
4. **Update StyleGuide documentation** to reflect new values
5. **Verify consistency** across all design system consumers

## When to Apply

1. **After browser preview CSS changes** - Apply immediately when user provides CSS changes from browser preview
2. **After modifying design system documentation** - Apply immediately after writing changes
3. **After modifying StyleGuide.tsx** - Apply immediately when any changes are made to `frontend/src/components/StyleGuide.tsx` (colors, typography, spacing, component examples, etc.)
4. **After updating color palette** - Update CSS variables in `:root` and `.dark` selectors
5. **After updating typography** - Update font sizes, weights, line heights in CSS
6. **After updating spacing scale** - Update spacing values if changed
7. **After updating component styles** - Update component implementations to match new styles

## Implementation

### Step 1: Extract Design Tokens

When browser preview CSS changes are provided OR `docs/ui/design_system.md` is modified OR `frontend/src/components/StyleGuide.tsx` is modified:

**For browser preview changes:**

1. **Parse CSS change data** from user-provided browser preview changes:
   - Extract `property`, `oldValue`, `newValue`, `selector`, `elementTagName`, `elementClasses`
   - Identify target element using `selector`, `elementPath`, or `elementClasses`
   - Map changes to appropriate source files (CSS, Tailwind classes, or component files)

2. **Locate target files:**
   - Global CSS: `frontend/src/index.css` for base typography, body, code styles
   - Component files: Find component using `reactComponent.name` or `elementPath`
   - Tailwind classes: Update className attributes in TSX files
   - CSS Modules: Update `.module.css` files if applicable

**For design system document changes:**

1. **Parse design system document** for:
   - Color values (light/dark mode)
   - Typography scales (font sizes, weights, line heights)
   - Spacing scale values
   - Component style definitions
   - Border radius values
   - Transition timings

2. **Map to CSS variables:**
   - Design system colors → CSS custom properties in `:root` and `.dark`
   - Typography → CSS base styles and variables
   - Spacing → Tailwind config or CSS variables
   - Component styles → Component CSS classes

**For StyleGuide.tsx changes:**

1. **Parse StyleGuide.tsx** for any design system changes:
   - **Color changes:** Extract color values from `lightColors` and `darkColors` arrays
     - Identify which colors changed (by name matching: "Background Primary", "Background Secondary", etc.)
     - Map color names to CSS variable names using Color Mapping section
   - **Typography changes:** Extract typography values (font sizes, weights, line heights) from component examples
   - **Spacing changes:** Extract spacing values from component examples
   - **Component style changes:** Identify any component style modifications in examples

2. **Map to CSS variables and documentation:**
   - **Colors:** `lightColors` values → CSS custom properties in `:root`, `darkColors` values → CSS custom properties in `.dark`
   - **Typography:** Update CSS base styles (`h1`, `h2`, `h3`, `h4`, `body`, `code`) in `frontend/src/index.css`
   - **Spacing:** Update Tailwind config or CSS variables if spacing scale changed
   - **Component styles:** Update component implementations if component styles changed
   - **Documentation:** Update corresponding values in `docs/ui/design_system.md` to maintain source of truth

### Step 2: Apply Changes to Source Files

**For browser preview changes:**

1. **Identify change type:**
   - **Global typography** (h1, h2, h3, h4, body, code) → Update `frontend/src/index.css`
   - **Tailwind utility classes** (text-base, text-sm, etc.) → Update className in component files
   - **Component-specific styles** → Update component CSS or inline styles
   - **CSS Modules** → Update `.module.css` file

2. **Apply changes:**
   - **CSS base styles:** Update `frontend/src/index.css` with new font-size values
   - **Tailwind classes:** Replace utility classes in TSX files (e.g., `text-base` → `text-sm`)
   - **Custom classes:** Update custom CSS classes in component files or CSS modules
   - **Documentation comments:** Update StyleGuide.tsx documentation comments to match new values

3. **Convert pixel values to rem:**
   - 24px → 1.5rem
   - 20px → 1.25rem
   - 16px → 1rem
   - 14px → 0.875rem
   - 13px → 0.8125rem
   - 10px → 0.625rem

**For design system document changes OR StyleGuide.tsx changes:**

Update `frontend/src/index.css`:

1. **Color variables:**

   ```css
   :root {
     --background: /* from design_system.md light mode */ --foreground:
       /* from design_system.md light mode */
       --primary: /* from design_system.md light mode */ /* ... */;
   }
   .dark {
     --background: /* from design_system.md dark mode */ --foreground:
       /* from design_system.md dark mode */
       --primary: /* from design_system.md dark mode */ /* ... */;
   }
   ```

2. **Typography:**
   - Update base styles for `h1`, `h2`, `h3`, `h4`, `body`, `code`
   - Match font sizes, weights, line heights from design system

3. **Spacing:**
   - Update spacing scale if changed
   - Ensure Tailwind config matches design system spacing

### Step 3: Update Component Styles and Documentation

**For browser preview changes:**

1. **Update StyleGuide.tsx** documentation comments to reflect new values:
   - Update font size comments (e.g., "H1 - 1.5rem (24px)" if changed from 32px)
   - Update Tailwind class names if changed (e.g., `text-base` → `text-sm`)
   - Ensure documentation matches actual CSS values

2. **Update affected components** if changes are component-specific:
   - Button components - Update if button styles changed
   - Input components - Update if input styles changed
   - Card components - Update if card styles changed
   - Table components - Update if table styles changed
   - Badge components - Update if badge styles changed

**For design system document changes:**
If design system changes affect component styles:

1. **Button components** - Update if button styles changed
2. **Input components** - Update if input styles changed
3. **Card components** - Update if card styles changed
4. **Table components** - Update if table styles changed
5. **Badge components** - Update if badge styles changed

### Step 4: Verify Consistency

1. **Check CSS variables** match design system values
2. **Check component implementations** use design system tokens
3. **Check StyleGuide component** displays updated values and documentation comments match
4. **Run build** to verify no CSS errors
5. **Verify pixel-to-rem conversions** are correct

## Design System Source of Truth

**Primary source:** `docs/ui/design_system.md`

**Implementation targets:**

- `frontend/src/index.css` - CSS variables and base styles
- `frontend/src/components/ui/*.tsx` - Component implementations
- `frontend/src/components/StyleGuide.tsx` - Design system preview

## Color Mapping

Design system colors map to CSS variables as follows:

**Light Mode:**

- `background.primary` → `--background`
- `background.secondary` → `--card`
- `foreground.primary` → `--foreground`
- `primary.primary` → `--primary`
- `status.success` → `--success` (if defined)
- `status.error` → `--destructive`
- `border.border` → `--border`

**Dark Mode:**

- Same mapping but using dark mode values from design system

## Typography Mapping

Design system typography maps to CSS as follows:

- `h1.font_size` → `h1 { font-size: ... }`
- `h1.font_weight` → `h1 { font-weight: ... }`
- `h1.line_height` → `h1 { line-height: ... }`
- `body.font_size` → `body { font-size: ... }`
- `mono.font_size` → `code, pre { font-size: ... }`

## Spacing Mapping

Design system spacing maps to Tailwind config or CSS variables:

- `spacing.xs` → `0.25rem` (4px)
- `spacing.sm` → `0.5rem` (8px)
- `spacing.md` → `1rem` (16px)
- `spacing.lg` → `1.5rem` (24px)
- `spacing.xl` → `2rem` (32px)

## Component Style Updates

When component styles change in design system:

1. **Button styles** - Update `frontend/src/components/ui/button.tsx`
2. **Input styles** - Update `frontend/src/components/ui/input.tsx`
3. **Card styles** - Update `frontend/src/components/ui/card.tsx`
4. **Table styles** - Update `frontend/src/components/ui/table.tsx`
5. **Badge styles** - Update `frontend/src/components/ui/badge.tsx`

## Rationale

- Ensures design system changes are immediately reflected in the app
- Prevents inconsistencies between documentation and implementation
- Maintains single source of truth (design system doc)
- Catches design system errors early
- Enables rapid design iteration

## Constraints

- **MUST** automatically apply browser preview CSS changes to source files without user request
- **MUST** automatically apply StyleGuide.tsx changes to CSS variables, component implementations, and design system doc without user request
- **MUST** update CSS variables when color palette changes (from any source: browser preview, design system doc, or StyleGuide.tsx)
- **MUST** update CSS base styles when typography changes in StyleGuide.tsx
- **MUST** update component implementations when component styles change in StyleGuide.tsx
- **MUST** update typography styles when typography scale changes
- **MUST** update component implementations when component styles change
- **MUST** update StyleGuide.tsx documentation comments to match new values
- **MUST** update design system doc when StyleGuide.tsx colors change to maintain source of truth
- **MUST** convert pixel values to rem units for consistency
- **MUST** verify changes don't break existing components
- **MUST NOT** skip updates - all design system changes must be applied
- **MUST** maintain consistency between design system doc, StyleGuide.tsx, and CSS implementation
- **MUST** identify correct target files using selector, elementPath, or reactComponent information

## Validation

After applying design system changes:

1. **CSS compilation** - Verify no CSS errors
2. **Component rendering** - Verify components display correctly
3. **StyleGuide preview** - Verify StyleGuide shows updated values
4. **Dark mode** - Verify dark mode colors are correct
5. **Accessibility** - Verify contrast ratios still meet WCAG AA

## Example Workflows

### Example 1: Browser Preview CSS Changes

1. User provides browser preview CSS changes:

   ```
   Change: h1 font-size from 32px to 24px
   Selector: <CardContent> h1
   ```

2. Agent automatically:
   - Identifies target: Global typography in `frontend/src/index.css`
   - Converts 24px to 1.5rem
   - Updates `frontend/src/index.css`:
     ```css
     h1 {
       font-size: 1.5rem; /* 24px */
       /* ... */
     }
     ```
   - Updates `frontend/src/components/StyleGuide.tsx` documentation:
     ```tsx
     <div className="text-xs text-muted-foreground mb-2 font-mono">
       H1 - 1.5rem (24px), 700 weight, -0.02em letter-spacing
     </div>
     ```
   - Verifies changes are applied correctly

### Example 2: Design System Document Changes

1. User modifies `docs/ui/design_system.md`:

   ```yaml
   primary:
     light:
       primary: "#0066CC" # Changed from "#0052A3"
   ```

2. Agent automatically:
   - Extracts new primary color: `#0066CC`
   - Updates `frontend/src/index.css`:
     ```css
     :root {
       --primary: 210 100% 40%; /* #0066CC */
     }
     ```
   - Verifies components using `--primary` will update automatically
   - Runs build to verify no errors

3. Changes cascade:
   - All buttons using `bg-primary` update automatically
   - All components using `text-primary` update automatically
   - StyleGuide preview shows new color

## Related Documents

- `docs/ui/design_system.md` - Design system specification
- `frontend/src/index.css` - CSS variables implementation
- `frontend/src/components/StyleGuide.tsx` - Design system preview
- `docs/ui/design_system_sync_rules.mdc` - Synchronization rules between design system and StyleGuide
